<!DOCTYPE html>




<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Kambi Widgets Source: src/Module/offeringModule.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>

<style>
    img {
    	max-width: 100%;
    }
</style>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Kambi Widgets</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="widget-components.html">widget-components</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-coreLibrary.html">coreLibrary</a></li><li><a href="module-eventsModule.html">eventsModule</a></li><li><a href="module-offeringModule.html">offeringModule</a></li><li><a href="module-statisticsModule.html">statisticsModule</a></li><li><a href="module-translationModule.html">translationModule</a></li><li><a href="module-utilModule.html">utilModule</a></li><li><a href="module-widgetModule.html">widgetModule</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="widget-components.DropdownButton.html">widget-components.DropdownButton</a></li><li><a href="widget-components.FixedList.html">widget-components.FixedList</a></li><li><a href="widget-components.Header.html">widget-components.Header</a></li><li><a href="widget-components.OutcomeButton.html">widget-components.OutcomeButton</a></li><li><a href="widget-components.OutcomeButtonUI.html">widget-components.OutcomeButtonUI</a></li><li><a href="widget-components.ScrolledList.html">widget-components.ScrolledList</a></li><li><a href="widget-components.TabPagination.html">widget-components.TabPagination</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-1 - Introduction.html">1 - Introduction</a></li><li><a href="tutorial-2 - Development.html">2 - Development</a></li><li><a href="tutorial-3 - Production Builds and Deployment.html">3 - Production Builds and Deployment</a></li><li><a href="tutorial-4 - Fetching Data.html">4 - Fetching Data</a></li><li><a href="tutorial-5 - Sportsbook Interaction.html">5 - Sportsbook Interaction</a></li><li><a href="tutorial-6 - Internationalization.html">6 - Internationalization</a></li><li><a href="tutorial-7 - Styling.html">7 - Styling</a></li><li><a href="tutorial-8 - Using React and widget-components.html">8 - Using React and widget-components</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#ALIGN_ITEMS">ALIGN_ITEMS</a></li><li><a href="global.html#FixedList_RenderItemContainerArgs">FixedList_RenderItemContainerArgs</a></li><li><a href="global.html#ScrolledList_RenderButtonArgs">ScrolledList_RenderButtonArgs</a></li><li><a href="global.html#ScrolledList_RenderItemContainerArgs">ScrolledList_RenderItemContainerArgs</a></li><li><a href="global.html#TabPagination_RenderTabListArgs">TabPagination_RenderTabListArgs</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: src/Module/offeringModule.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">import coreLibrary from '../coreLibrary';

/**
 * Module with methods to request data from the offering API
 * The offering API has information concerning events (matches, competations) and their respective betoffers as well as live data if available
 * All methods in this module return Promises that are resolved when the data is ready and throws errors (that can be handled with .catch()) on failure
 * @module offeringModule
 */

export default {

   /**
    * Get group events
    * @param {number|string} groupId Group id
    * @returns {Promise}
    */
   getGroupEvents (groupId) {
      var requesPath = '/event/group/' + groupId + '.json';
      return this.doRequest(requesPath);
   },

   /**
    * Get group information.
    * @param {Number|String} groupId Group id
    * @returns {Promise}
    */
   getGroup (groupId) {
      var requesPath = '/group/' + groupId + '.json';
      return this.doRequest(requesPath);
   },

   /**
    * Get events by filter, only returns the main betoffer for the event. To get all betoffers use getEvent() or getLiveEvent()
    * @param {String} filter Filter string, eg: football
    * @param {Object} params Request relevant parameters
    * @returns {Promise}
    */
   getEventsByFilter (filter, params) {
      // Todo: Update this method once documentation is available
      filter = filter.replace(/^#?\/?/, ''); // removes #/ at the start of the string if present
      var requestPath = '/listView/' + filter;
      return this.doRequest(requestPath, params, 'v3');
   },

   /**
    * Normalizes v2 api betoffers
    * @param {Object} betOffer Betoffer object we get from api
    * @private
    */
   adaptV2BetOffer (betOffer) {
      if (betOffer.suspended === true) {
         betOffer.open = false;
      }
   },

   /**
    * Normalizes the v2 api response
    * @param {Object} liveData Livedata object we get from api
    * @private
    */
   adaptV2LiveData (liveData) {
      if (liveData != null &amp;&amp; liveData.statistics != null) {
         var statistics = liveData.statistics;
         if (statistics.sets != null) {
            statistics.setBasedStats = statistics.sets;
            delete statistics.sets;
         }

         if (statistics.football != null) {
            statistics.footballStats = statistics.football;
            delete statistics.football;
         }
      }
   },

   /**
    * Normalizes the v2 event object
    * @private
    */
   adaptV2Event (event) {
      // v3 and v2 event objects are almost the same
      // only a few attributes we don't use are different
   },

   /**
    * Get live event data only, eg: match statistics, score, macthClock
    * @param {Number|String} eventId The event id we need to fetch
    * @returns {Promise}
    * @private
    */
   getLiveEventData (eventId) {
      var requestPath = '/event/' + eventId + '/livedata.json';
      return this.doRequest(requestPath, null, null, true)
         .then((res) => {
            this.adaptV2LiveData(res);
            return res;
         });
   },

   /**
    * Get all live events, only returns the main betoffer for the event. To get all betoffers use getEvent() or getLiveEvent()
    * @returns {Promise}
    * @private
    */
   getLiveEvents () {
      var requestPath = '/event/live/open.json';
      return this.doRequest(requestPath, null, null, true)
         .then((res) => {
            if (res.error != null) {
               return res;
            }
            var events = res.liveEvents;
            res.events = events;
            res.events.forEach(this.adaptV2Event);
            delete res.liveEvents;
            delete res.group;
            events.forEach((e) => {
               e.betOffers = [];
               if (e.mainBetOffer != null) {
                  this.adaptV2BetOffer(e.mainBetOffer);
                  e.betOffers.push(e.mainBetOffer);
                  delete e.mainBetOffer;
               }
               this.adaptV2LiveData(e.liveData);
            });
            return res;
         });
   },

   /**
    * Returns a live event
    * @param {Number|String} eventId The event id we need to fetch
    * @returns {Promise}
    */
   getLiveEvent (eventId) {
      var requestPath = '/betoffer/live/event/' + eventId + '.json';
      return this.doRequest(requestPath, null, null, true)
         .then((res) => {
            res.betOffers = res.betoffers;
            delete res.betoffers;
            res.betOffers.forEach(this.adaptV2BetOffer);
            res.event = res.events[0];
            this.adaptV2Event(res.event);
            delete res.events;
            return res;
         });
   },

   /**
    * Get live events by filter, only returns the main betoffer for the event. To get all betoffers use getEvent() or getLiveEvent()
    * @param {String} filter Filter string
    * @returns {Promise}
    */
   getLiveEventsByFilter (filter) {
      // Todo: implement a filter request when the offering API supports it
      filter = filter.replace(/\/$/, '');

      var filterTerms = filter.split('/');
      filterTerms = filterTerms.slice(0, 3);

      var requestPath = '/listView/all/all/all/all/in-play/';

      return new Promise((resolve, reject) => {
         this.doRequest(requestPath, null, 'v3')
            .then((response) => {
               var result = {
                     events: []
                  },
                  i = 0, len = response.events.length;
               for (; i &lt; len; ++i) {
                  var j = 0, termLen = response.events[i].event.path.length, addEvent = true;
                  if (termLen > filterTerms.length) {
                     termLen = filterTerms.length;
                  }
                  for (; j &lt; termLen; ++j) {
                     if (filterTerms[j] !== 'all' &amp;&amp; response.events[i].event.path[j].termKey !== filterTerms[j]) {
                        addEvent = false;
                     }
                  }
                  if (addEvent) {
                     result.events.push(response.events[i]);
                  }
               }
               resolve(result);
            });
      });
   },

   /**
    * Requests and event from api
    * @param {String} eventId The event id we need to fetch
    * @returns {Promise}
    */
   getEvent (eventId) {
      return this.doRequest('/betoffer/event/' + eventId + '.json')
         .then((res) => {
            res.betOffers = res.betoffers;
            delete res.betoffers;
            res.betOffers.forEach(this.adaptV2BetOffer);
            res.event = res.events[0];
            this.adaptV2Event(res.event);
            delete res.events;
            return res;
         });
   },

   /**
    * Request the highlight resource which is what is shown under the "Popular" section in the Sportsbook
    * @returns {Promise}
    */
   getHighlight () {
      return this.doRequest('/group/highlight.json')
         .then((highlights) => {
            // sorting based on sortOrder
            if ( Array.isArray(highlights.groups) ) {
               highlights.groups.sort(( a, b ) => {
                  if ( parseInt(a.sortOrder, 10) > parseInt(b.sortOrder, 10) ) {
                     return 1;
                  }
                  if ( parseInt(a.sortOrder, 10) &lt; parseInt(b.sortOrder, 10) ) {
                     return -1;
                  }
                  return 0;
               });
            }
            return highlights;
         });
   },

   /**
    * Makes a request to provided path setting the appropriated URL parameters. Usually this method should not be called directly, unless you want to access an endpoint that is not available in the other methods
    The final url looks like:
    coreLibrary.config.apiBaseUrl + version + coreLibrary.config.offering + requestPath
    Example (same as calling offeringModule.getLiveEvents() but forcing to use Portugal Portuguese locale)
    doRequest('/event/live/open.json' { lang: 'pt_PT' });
    this call would fetch this url:

    https://api.kambi.com/offering/api/v2/kambi/event/live/open.json?lang=pt_PT&amp;market=kambi&amp;client_id=2&amp;include=&amp;betOffers=COMBINED&amp;categoryGroup=COMBINED&amp;displayDefault=true&amp;nocache=1476973932524

    * @param {string} requestPath the path to the request
    * @param {object} params params to use, can override the parameters this method usually sets
    * @param {number|string} version which version of the API to use. Some endpoints are 'v2' and some are 'v3'
    * @param {boolean} noCache if true will add a cache-busting URL parameter. Defaults to true
    * @returns {Promise}
    */
   doRequest (requestPath, params, version, noCache) {
      var config = coreLibrary.config;
      if (config.offering == null) {
         console.warn('The offering has not been set, is the right widget api version loaded?');
      } else {
         var apiUrl = config.apiBaseUrl.replace('{apiVersion}',
            (version != null ? version : config.version));
         var requestUrl = apiUrl + config.offering + requestPath;
         var overrideParams = params || {};
         var requestParams = {
            lang: overrideParams.locale || config.locale,
            market: overrideParams.market || config.market,
            client_id: overrideParams.client_id || config.client_id,
            include: overrideParams.include || '',
            betOffers: overrideParams.betOffers || 'COMBINED',
            categoryGroup: overrideParams.categoryGroup || 'COMBINED',
            displayDefault: overrideParams.displayDefault || true
         };
         if (noCache === true) {
            requestParams.nocache = Date.now();
         }
         requestUrl += '?' + Object.keys(requestParams).map(function (k) {
            return encodeURIComponent(k) + '=' + encodeURIComponent(requestParams[k]);
         }).join('&amp;');

         return coreLibrary.getData(requestUrl);
      }
   }
};
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
